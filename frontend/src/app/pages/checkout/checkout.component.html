<div class="container mx-auto p-4 mt-10 max-w-2xl">
    <h1 class="text-3xl font-bold mb-6">Checkout</h1>

    @if (loading()) {
    <div class="text-center py-8">Loading...</div>
    } @else if (!cartService.cart() || cartService.cart()!.items.length === 0) {
    <div class="text-center py-8">
        <p class="text-gray-600 mb-4">Your cart is empty</p>
        <a routerLink="/" class="text-blue-500 hover:underline">Go Shopping</a>
    </div>
    } @else {
    <!-- Order Summary -->
    <div class="bg-white rounded shadow-md p-6 mb-6">
        <h2 class="text-xl font-bold mb-4">Order Summary</h2>
        @for (item of cartService.cart()!.items; track item.productId) {
        <div class="flex justify-between py-2 border-b">
            <div>
                <p class="font-medium">{{ item.productName }}</p>
                <p class="text-sm text-gray-600">Qty: {{ item.quantity }}</p>
            </div>
            <p class="font-medium">{{ item.subtotal | currency }}</p>
        </div>
        }
        <div class="flex justify-between pt-4 mt-2">
            <p class="text-xl font-bold">Total:</p>
            <p class="text-xl font-bold">{{ cartService.cart()!.totalAmount | currency }}</p>
        </div>
    </div>

    <!-- Shipping Address Form -->
    <div class="bg-white rounded shadow-md p-6 mb-6">
        <h2 class="text-xl font-bold mb-4">Shipping Address</h2>
        <form (ngSubmit)="placeOrder()" #checkoutForm="ngForm">
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">Street Address</label>
                <input type="text" [(ngModel)]="shippingAddress.street" name="street" required
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-gray-700 mb-2">City</label>
                    <input type="text" [(ngModel)]="shippingAddress.city" name="city" required
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">State</label>
                    <input type="text" [(ngModel)]="shippingAddress.state" name="state" required
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-gray-700 mb-2">ZIP Code</label>
                    <input type="text" [(ngModel)]="shippingAddress.zipCode" name="zipCode" required
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Country</label>
                    <input type="text" [(ngModel)]="shippingAddress.country" name="country" required
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="flex gap-4">
                <button type="button" routerLink="/cart"
                    class="flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-100 transition">
                    Back to Cart
                </button>
                <button type="submit" [disabled]="submitting() || !checkoutForm.valid"
                    class="flex-1 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                    @if (submitting()) {
                    <span>Placing Order...</span>
                    } @else {
                    <span>Place Order</span>
                    }
                </button>
            </div>
        </form>
    </div>
    }
</div>